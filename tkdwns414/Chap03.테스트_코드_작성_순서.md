# Chapter 3. 테스트 코드 작성 순서

## 테스트 코드 작성 순서

지난번 암호 강도 측정 예시에서 예상만 할 수 있었던 부분인 테스트 코드 작성 순서에 대해서 알아볼 수 있다.
보통 아래와 같은 방법 중 하나로 테스트를 작성해나간다고 한다.

- 쉬운 경우에서 어려운 경우로 진행
- 예외적인 경우에서 정상인 경우로 진행

위와 반대로 어려운 경우에서 쉬운 경우로 진행하거나 정상 상황을 먼저 시작하면 구현 과정이 원활하게 진행되지 않기도 한다.

### 초반에 복잡한 테스트부터 시작하면 안 되는 이유

- 초반부터 다양한 조합을 검사하는 복잡한 상황을 테스트로 추가하면 해당 테스트를 통과시키기 위해 한 번에 구현해야 할 코드가 많아진다.
- 한 번에 완벽한 코드를 만들면 좋겠지만 사람이기에 실수할 수 있고 그 결과 생긴 버그를 잡기 위해 많은 시간을 허비하게 될 확률이 높다.

+) 작은 것부터 생각하지 않고 복잡한 것을 먼저 생각하면 놓치는 부분이 생길 수 있다고 생각한다. 두 조건이 같이 영향을 주는 경우 같은 상황을 정리하기가 힘들 수도 있지 않을까 싶다.

### 구현하기 쉬운 테스트부터 시작하기

- TDD의 핵심은 점진적인 구현이다.
- 하나의 테스트를 통과했을 때 그다음으로 구현하기 쉬운 테스트를 선택해서 진행해야한다.
- 한 번에 구현하는 시간이 짧아지면 디버깅할 때 유리하다. 작성한 코드가 많지 않고 작업 시간이 짧아 작성한 코드에 대한 내용을 잘 기억학 있기 때문이다.

### 예외 상황을 먼저 테스트해야하는 이유

- 예외 상황은 복잡한 if-else 블록을 동반할 떄가 많다.
- 이떄 예외를 고려하지 않은 코드에 예외 경우를 넣으려고 한다면 코드 구조를 많이 바꿔야 할 확률이 높다. (실제로 예외 처리하기 위해 추가적으로 메소드 만들고 빼고 하는 작업을 해본 적 있음)
- 예외 상황을 먼저 찾고 테스트에 반영하면 예외 상황을 처리하지 않아 발생하는 버그를 줄일 수 있다.
- 예외 상황을 처리하지 않을 경우 **시스템 운영 중 에러가 발생할 수 있다.**

### 완급 조절

처음 TDD를 할 때 어려울 수 있는 코드의 작성 범위에 대한 이야기를 설명해준다. 그리고 권장하는 연습 과정을 제시해주는데 처음 TDD를 접한 사람에게는 다음 과정을 권장한다.

```pascal
1. 정해진 값을 리턴
2. 값 비교를 이용해서 정해진 값을 리턴
3. 다양한 테스트를 추가하면서 구현을 일반화
```

위 순서에 맞게 단계적으로 나아가는 연습을 해온 개발자는 테스트를 만들고 통과시키는 과정에서 연습하지 않은 개발자보다 더 잘해나갈 수 있다. (점진적인게 중요하다)

상수를 사용해서 구현 후 일반화하는 과정을 거치면 나중에 구현이 잘 안될 때도 점진적으로 구현할 수 있다고 한다.
+) 개인적으로 아직 겪어보지 않아서 잘 모르겠긴 함

### 지속적인 리팩토링

- 테스트를 통과한 뒤 필요에 의해 리팩토링을 진행한다. (여기서 말하는 것은 테스트코드 말고 구현 코드)
  **_리팩토링 시점_**

1. 상수를 변수로 바꾸거나 변수 이름을 변경하는 경우 -> 바로 진행
2. 메소드 추출 등 메소드 구조에 영향을 주는 경우 -> 큰 틀의 구현 흐름이 눈에 들어온 후 진행 (흐름 파악 전 진행할 경우 코드 구조를 잘못 잡을 가능성이 높아지고 구현이 어려워질 수 있음)

## 작성 순서 예제

OTT 기능 같은 것을 이번 TDD의 예로 설명을 한다.

+) 예외 상황처리에서 2월, 윤일, 30일, 31일 생각 바로 못 떠올린게 개인적으로 아쉬웠음

## 테스트 목록

TDD를 시작할 때 테스트할 목록을 미리 정리하면 좋다

- 테스트할 내용을 정리한 후 어떤 테스트가 구현이 쉬울지, 예외적인지 상상하면 테스트 선택애 도움이 된다.
- 당연히 처음부터 모든 사례를 정리하기는 쉽지 않다. 개발 중 발견한 사례가 있다면 추가하는 것을 잊지 말아야 한다. -> 새로 발견한 테스트 사례를 실패하는 테스트로 등록하면 잊지 않을 수 있다.
- **_테스트 목록을 적었다고 해서 테스트를 한 번에 다 작성하면 안된다._** -> 구현 초기에 리팩토링 하기가 쉽지 않게 된다. & 계속해서 깨지는 테스트가 존재하므로 개발 리듬이 유지가 되지 않는다.
- 범위가 큰 리팩토링 거리를 발견했을 때는 리팩토링에 우선을 두지 말고 우선 테스트의 통과에 집중한다. + 범위가 큰 리팩토링 전에는 꼭 커밋을 하자

## 이외 꿀팁

### 시작이 안될 때는 단언부터 고민

테스트 코드를 작성할 때 시작이 잘 안된다면 검증하는 코드부터 작성하면 좋다.

- 검증하는 코드에 어떤 것을 검증할지 생각을 한다.
- 해당 표현을 어떻게 해야할지 결정을 하게 된다.
- 검증에 필요한 변수를 구하는 코드를 생각하게 된다.

### 구현이 막힌다면?

TDD 진행 중 구현이 막힌다면? **_과감하게 삭제한다_**
쉬운 테스트, 예외적인 테스트, 완급 조절 부분을 잘 생각하며 하자

+) 개인적으로 '과감히 삭제하기'는 생각이 꼬여버렸을 때 아주 좋은방법 같음. 알고리즘 풀다가도 자주 쓰는 방법
