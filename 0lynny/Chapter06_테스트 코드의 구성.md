## Chapter06. 테스트 코드의 구성

### 기능에서의 상황

기능은 주어진 상황에 따라 다르게 동작한다. 이는 테스트 구조에도 영향을 준다. 노련한 개발자는 어떤 상황이 실행 결과에 영향을 줄 수 있는지 찾기 위해 노력한다. 결과에 영향을 줄 수 있는 상황을 고려하지 않은 코드는 버그를 포함할 가능성이 크기 떄문이다. 다양한 예외 상황을 찾아내고 이를 코드에 반영해야 기능이 비정상적으로 동작하는 것을 막을 수 있다. 이런 과정을 거치면서 소프트웨어의 품질을 높일 수 있다.  

### 테스트 코드의 구성 요소 : 상황, 실행, 결과 확인

테스트 코드는 기능을 실행하고 그 결과를 확인하므로 상황(given), 실행(when), 결과(then) 확인의 세 가지 요소로 테스트를 구성할 수 있다. 

```java

@Test
void exactMatch() {
// given - 정답이 456인 상황
BasebalGame game = new BasebalGame ("456"); 
// when - 실행
Score score =game.guess"( 456"); 
// then - 결과 확인
assertEquals(3, score,strikes()); assertE
```

그렇다고 해당 구조에 너무 집착할 필요는 없다. 이 구조가 테스트 코드를 작성하는데 도움이 되는 것은 맞지만 꼭 모든 테스트 메서드를 이 구조로 만들어야하는 것은 아니다. 

### 외부 상황과 외부 결과

상황 설정이 테스트 대상으로 국한된 것은 아니다. 외부 요인도 포함될 수 있다. 테스트는 실행할 때 마다 동일한 결과를 보장해야하는데 우연에 의해 테스트 결과가 달라지면 동일한 결과를 보장할 수 없다. 

### 외부 상태가 테스트 결과에 영향을 주지 않게 하기

테스트 코드는 한 번만 실행하고 끝나지 않는다. TDD를 진행하는 동안에도 계속 실행하고 끝난 이후에도 반복적으로 테스트를 실행해서 문제가 없는지 검증한다. 그렇기 때문에 언제 실행해도 정상적으로 동작해야한다. 

외부 상황에 따라 테스트의 성공여부가 바뀌지 않으려면 테스트 실행 전에 외부를 원하는 상태로 만들거나 테스트 실행 후에 외부 상태를 원래대로 되돌려 놓아햐한다. 

### 외부 상태와 테스트 어려움

상황과 결과에 영향을 주는 외부 요인은 파일, DBMS, 외부 서버 등 다양하다.

테스트 대상이 아닌 외부 요인은 테스트 코드에서 다루기 어려운 존재이며, 마음대로 제어할 수 없는 경우가 생긴다. 또한 테스트 코드에서 생성한 외부 결과를 마음대로 초기화하기 힘들 때도 있다. 이렇게 테스트 대상의 상황과 결과에 외부 요인이 관여할 경우 대역을 사용하면 된다. 대역은 대상이 의존하는 대상의 실제 구현을 대신하는 구현인데 이 대역을 통해 외부 상황이나 결과를 대체할 수 있게 된다.
